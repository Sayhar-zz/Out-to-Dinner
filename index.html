<html xmlns="http://www.w3.org/1999/xhtml">
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
        <title>Test</title>
        <link rel="stylesheet" href="css/reset.css" />
        <link rel="stylesheet" type="text/css" href="map.css" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCeZsLgeVOHiLdy-NZzbaXhgz6ew731SZc&sensor=false">
            
        </script>
        <script type="text/javascript" src="maphelper.js">
            
        </script>
        </script>
    </head>
    
    <body onload="makeMap()">

        <script language="javascript">
                    var myObjectId;
                        var mySessToken;
                        
            function getURLParameter(name) {
                name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
                var regexS = "[\\?&]" + name + "=([^&#]*)";
                var regex = new RegExp(regexS);
                var results = regex.exec(window.location.href);
                if (results == null) return "";
                else return results[1];
            }

            function registerHandler(data) {
                            myObjectId = data.objectId;
                                mySessToken = data.sessionToken;
                $('#email_reg').hide();
                $('#dashboard').show();
                makeMap(data.objectId, data.sessionToken, data.markerId);

            }


                        function volunteerHandler() {
                                
                        };

            function volunteerUser(form, callback) {
                var thisURL = "https://api.parse.com/1/users/" + myObjectId;
                var userInput = form.group1.value;
                var superVolunteer = form.vehicle.value;
                var dataIn = {
                    "volunteer": (superVolunteer == "supervolunteer"),
                    "host": (userInput == "host"),
                    "guest": (userInput == "guest")
                };
                $.ajax({
                    type: "PUT",
                    url: thisURL,
                    headers: {
                        "X-Parse-Application-Id": "oEhx7MD4NJ9dmwOTJVYIsDtSPRwxYYlXSwm13dI3",
                        "X-Parse-REST-API-Key": "jd6bIkiEcWb89gHyQUuMYhst6d6hkWkcB3ySWzUv",
                        "X-Parse-Session-Token": mySessToken,
                    },
                    contentType: "application/json",
                    data: JSON.stringify(dataIn),
                    error: function (xhr) {
                        alert(xhr.statusText);
                    },
                    success: function (data) {
                        console.info(data);//callback(data);
                    }
                })
            };

            function logInUser(form, callback) {
                var usernameIn = "username=" + form.Email.value;
                var passwordIn = "password=" + "temp";
                var dataIn = usernameIn + "&" + passwordIn;

                $.ajax({
                    type: "GET",
                    url: "https://api.parse.com/1/login",
                    headers: {
                        "X-Parse-Application-Id": "oEhx7MD4NJ9dmwOTJVYIsDtSPRwxYYlXSwm13dI3",
                        "X-Parse-REST-API-Key": "jd6bIkiEcWb89gHyQUuMYhst6d6hkWkcB3ySWzUv",
                    },
                    data: dataIn,
                    contentType: "application/json",
                    error: function (xhr) {
                        alert(xhr.statusText)
                    },
                    success: function (data) {
                        console.info(data);
                        callback(data);
                    }
                })
            };

            function registerUser(form, callback) {

                var emailIn = form.Email.value;
                var dataIn = {
                    "username": emailIn,
                    "password": "temp",
                    "email": emailIn,
                    "markerID": null,
                    "volunteer": false,
                    "host": false,
                    "guest": false,
                };
                dataIn = JSON.stringify(dataIn);
                jQuery.ajax({
                    type: "POST",
                    url: "https://api.parse.com/1/users",
                    contentType: "application/json",
                    headers: {
                        "X-Parse-Application-Id": "oEhx7MD4NJ9dmwOTJVYIsDtSPRwxYYlXSwm13dI3",
                        "X-Parse-REST-API-Key": "jd6bIkiEcWb89gHyQUuMYhst6d6hkWkcB3ySWzUv",
                    },
                    data: dataIn,
                    crossDomain: true,
                    processData: false,
                    dataType: "json",
                    error: function (xhr) {
                        alert("Registration failed.");
                    },
                    success: function (data) {
                        console.info(data);
                        callback(data);
                    }
                })
            };
        </script>

						<script language="javascript">
							function getURLParameter(name) {
								name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
								var regexS = "[\\?&]" + name + "=([^&#]*)";
								var regex = new RegExp(regexS);
								var results = regex.exec(window.location.href);
								if (results == null) return "";
								else return results[1];
							}
				
							function registerHandler(data) {
				
								$('#email_reg').hide();
								$('#dashboard').show();
								makeMap(data.objectId, data.sessionToken, data.markerId);
				
							}
				
							function volunteerUser(form, callback) {
								var thisURL = "https://api.parse.com/1/users/" + objectID;
								var userInput = form.group1.value;
								var superVolunteer = form.vehicle.value;
								var dataIn = {
									"volunteer": superVolunteer,
									"host": (userInput == "host"),
									"guest": (userInput == "guest")
								};
								$.ajax({
									type: "PUT",
									url: thisURL,
									headers: {
										"X-Parse-Application-Id": "oEhx7MD4NJ9dmwOTJVYIsDtSPRwxYYlXSwm13dI3",
										"X-Parse-REST-API-Key": "jd6bIkiEcWb89gHyQUuMYhst6d6hkWkcB3ySWzUv",
										"X-Parse-Session-Token": sessToken,
									},
									contentType: "application/json",
									data: JSON.stringify(dataIn),
									error: function (xhr) {
										alert(xhr.statusText);
									},
									success: function (data) {
										callback(data);
									}
								})
							};
				
							function logInUser(form, callback) {
								var usernameIn = "username=" + form.Email.value;
								var passwordIn = "password=" + "temp";
								var dataIn = usernameIn + "&" + passwordIn;
				
								$.ajax({
									type: "GET",
									url: "https://api.parse.com/1/login",
									headers: {
										"X-Parse-Application-Id": "oEhx7MD4NJ9dmwOTJVYIsDtSPRwxYYlXSwm13dI3",
										"X-Parse-REST-API-Key": "jd6bIkiEcWb89gHyQUuMYhst6d6hkWkcB3ySWzUv",
									},
									data: dataIn,
									contentType: "application/json",
									error: function (xhr) {
										alert(xhr.statusText)
									},
									success: function (data) {
										console.info(data);
										callback(data);
									}
								})
							};
				
							function registerUser(form, callback) {
				
								var emailIn = form.Email.value;
								var dataIn = {
									"username": emailIn,
									"password": "temp",
									"email": emailIn,
									"markerID": null,
									"volunteer": false,
									"host": false,
									"guest": false,
								};
								dataIn = JSON.stringify(dataIn);
								jQuery.ajax({
									type: "POST",
									url: "https://api.parse.com/1/users",
									contentType: "application/json",
									headers: {
										"X-Parse-Application-Id": "oEhx7MD4NJ9dmwOTJVYIsDtSPRwxYYlXSwm13dI3",
										"X-Parse-REST-API-Key": "jd6bIkiEcWb89gHyQUuMYhst6d6hkWkcB3ySWzUv",
									},
									data: dataIn,
									crossDomain: true,
									processData: false,
									dataType: "json",
									error: function (xhr) {
										alert("Registration failed.");
									},
									success: function (data) {
										console.info(data);
										callback(data);
									}
								})
							};
						</script>
        

        <div id="email_reg">
			<section id="main" class="cf">	
			<section id="outter-grad" class="cf">	
			<section id="radial-grad" class="cf">
			<section id="main-content">
			<a href="index.html"><img src="http://westergaard.com/outtodinner/img/out-to-dinner.png" id="logo"></a>
            <div id="email_canvas">
            	<section id="test">
				<section id="buttons">
					<section id="signup" class="notbutton"><img src="email.png"></section>
					<!-- 
					<section id="login" class="notbutton"><img src="password.png"></section>
					<section id="login" class="notbutton"><img src="forgotp.png"></section>
 					-->
				</section>
            	<form id="email_reg_form">
                	<input required name="Email" form="email_reg_form" placeholder=" e-mail address" type="email" style="font-family: Verdna; font-size: 40px; width:100%"/>
                	<br>
                	<div id="buttons">
                	<section id="signup" class="button3">
                	<input type="image" src="http://westergaard.com/outtodinner/img/signup.png" width="101" alt="submit" name="submit" value="submit" form="email_reg_form"/>
                	<!-- <input type="submit" form="email_reg_form"/> -->
                	</section>
                	</div>
            	</form>
            	</section>
			<!-- 
            <section id="buttons">
            			<section id="signup" class="button2"><img src="login.png"></section>
						<section id="signup" class="button2"><img src="http://westergaard.com/outtodinner/img/signup.png"></section>
			</section>
 			-->
			</div>
            </section>
            </section>
            </section>
            </section>
        </div>
        

		<div id="dashboard" style="display:none;">
			<section id="main" class="cf">	
			<section id="outter-grad" class="cf">	
			<section id="radial-grad" class="cf">
			<section id="main-content">
			<a href="index.html"><img src="http://westergaard.com/outtodinner/img/out-to-dinner.png" id="logo"></a>
			<section id="buttons">
				<div style="text-align: center;"><p>Click the location of your event to place your pin on the map
				<br>Press 'Save' to save your location
				<br>Share your thoughts with the Out to Dinner community
				<br>To change your location, click a new location and press 'Save'</p></div>
			</section>
			<div id="map_canvas"></div>
			<section id="buttons">
				<div style="margin-left: auto; margin-right: auto; text-align: center;">
				<form id="volunteer">
					<span id="signup" class="button3">
                	<input type="image" id="hostbutton" src="host.png" width="101" alt="submit" name="submit" value="submit" form="volunteer"/>
                	</span>
                	<span id="signup" class="button3">
                	<input type="image" id="guestbotton" src="guest.png" width="101" alt="submit" name="submit" value="submit" form="volunteer"/>
                	</span>
                	<span id="signup" class="button3">
                	<input type="image" id="superbutton" src="volunteer.png" height="25" alt="submit" name="submit" value="submit" form="volunteer"/>
                	</span>
			    	<!-- 
					<input type="image" form="volunteer" id="hostbutton" src="click1.png">
			    	<input type="image" form="volunteer" id="guestbutton" src="click1.png">
			    	<input type="image" form="volunteer" id="superbutton" src="click1.png">
 					-->
				</form>
				</div>
			</section>
			<section id="buttons">
						<section id="signup" class="button2"><img src="http://westergaard.com/outtodinner/img/signup.png"></section>
						<section id="donate" class="button2"><img src="http://westergaard.com/outtodinner/img/donate.png"></section>
			</section>
			<br>
			
			<!-- 
			<div id="hostguest">Are you signing up to:
                <br>
                <form id="volunteer">
                    <input type="radio" form="volunteer" name="group1" value="host">Host an event
                    <br>
                    <input type="radio" form="volunteer" name="group1" value="guest">Attend an event
                    <br>
                    <input type="checkbox" form="volunteer" name="vehicle" value="supervolunteer">Become a media volunteer
                    <br>
                    <input type="submit" form="volunteer" onclick="volunteerUser(this.form, volunteerHandler)">
                </form>
            </div>
			 -->

            </section>
            </section>
            </section>
            </section>
        </div>
 
        
    <script language="javascript"> <!-- must go after the form HTML -->
        $('#email_reg_form').submit(function(event) {
                event.preventDefault();
                registerUser(document.getElementById('email_reg_form'), registerHandler);
                return false;
        });
        
        $('#volunteer').submit(function(event) {
                event.preventDefault();
                volunteerUser(document.getElementById('volunteer'), volunteerHandler);
                return false;
        });
        
        $('#imgbutton').click(function(event) {
                event.preventDefault();
                if ((document.getElementById('imgbutton')).src == "off.png") {
                        (document.getElementById('imgbutton')).src = "on.png";
                }
                else if ((document.getElementById('imgbutton')).src == "on.png") {
                        (document.getElementById('imgbutton')).src = "off.png";
                }
                return false;
        });
        
        </script>
		</script>    
    
    </body>
</html>
